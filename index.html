<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вестник-Томпо</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        /* Шапка */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 5px;
            color: white;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        /* Панель пользователя */
        .user-panel {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4a6491;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .user-name {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .user-role {
            background: #e7f3ff;
            color: #1877f2;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Вкладки */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: #f5f7fa;
        }
        
        .tab.active {
            color: #1877f2;
            border-bottom: 3px solid #1877f2;
            background: #f0f7ff;
        }
        
        /* Кнопки */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #1877f2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #166fe5;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(24, 119, 242, 0.2);
        }
        
        .btn-success {
            background: #42b72a;
            color: white;
        }
        
        .btn-success:hover {
            background: #36a420;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(66, 183, 42, 0.2);
        }
        
        .btn-secondary {
            background: #e4e6eb;
            color: #050505;
        }
        
        .btn-secondary:hover {
            background: #d8dadf;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        /* Карточки */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .news-card, .ad-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .news-card:hover, .ad-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .card-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .news-title, .ad-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c3e50;
            line-height: 1.4;
        }
        
        .news-date, .ad-date {
            color: #8a8d91;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .card-content {
            padding: 15px;
        }
        
        .news-excerpt, .ad-description {
            color: #65676b;
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .author-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #65676b;
        }
        
        .author-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4a6491;
            color: white;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ad-price {
            color: #1877f2;
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .ad-location {
            color: #65676b;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }
        
        /* Формы */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.2);
            animation: modalAppear 0.3s;
        }
        
        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #65676b;
            line-height: 1;
        }
        
        .close-modal:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #dddfe2;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1877f2;
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        /* Пустой экран */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            background: white;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .empty-state p {
            color: #65676b;
            margin-bottom: 25px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #42b72a;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(66, 183, 42, 0.3);
            z-index: 1001;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Админ-панель */
        .admin-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .admin-panel h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1877f2;
        }
        
        .stat-label {
            font-size: 14px;
            color: #65676b;
            margin-top: 5px;
        }
        
        /* Для телефонов */
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .user-panel {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .action-buttons {
                width: 100%;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            .modal-content {
                padding: 20px;
                margin: 20px auto;
            }
            
            .user-stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* Детальный просмотр */
        .detail-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .detail-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .detail-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2c3e50;
            line-height: 1.3;
        }
        
        .detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            color: #65676b;
            font-size: 14px;
        }
        
        .detail-content {
            font-size: 16px;
            line-height: 1.7;
            color: #333;
            margin: 25px 0;
            white-space: pre-line;
        }
        
        .detail-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        /* Контактная информация */
        .contact-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
        }
        
        .phone-number {
            font-size: 22px;
            font-weight: bold;
            text-align: center;
            color: #1877f2;
            margin: 10px 0;
        }
        
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 25px;
            color: #2c3e50;
        }
        
        /* Поиск и фильтры */
        .filters {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #dddfe2;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .filter-select {
            padding: 10px;
            border: 2px solid #dddfe2;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        /* НОВЫЕ СТИЛИ ДЛЯ ФИЛЬТРОВ НОВОСТЕЙ */
        .filter-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .filter-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .filter-section h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .category-tag {
            padding: 8px 15px;
            background: #f0f2f5;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .category-tag:hover {
            background: #e4e6eb;
        }

        .category-tag.active {
            background: #1877f2;
            color: white;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .date-input {
            padding: 8px 12px;
            border: 2px solid #dddfe2;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .contact-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn-call {
            background: #25D366;
            color: white;
        }

        .btn-message {
            background: #0088cc;
            color: white;
        }

        .btn-copy {
            background: #6c757d;
            color: white;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .filter-badge {
            background: #e7f3ff;
            color: #1877f2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .time-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 8px 15px;
            background: #f0f2f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .time-btn:hover {
            background: #e4e6eb;
        }

        .time-btn.active {
            background: #1877f2;
            color: white;
        }
        
        .icon {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <div class="header">
        <h1>Вестник-Томпо</h1>
        <p>Новости и объявления вашего района</p>
    </div>
    
    <!-- Панель пользователя -->
    <div class="user-panel" id="userPanel">
        <div class="user-info">
            <div class="user-avatar" id="userAvatar">Г</div>
            <div>
                <div class="user-name" id="userName">Гость</div>
                <div class="user-role" id="userRole">Не авторизован</div>
            </div>
        </div>
        <div class="action-buttons" id="authButtons">
            <button class="btn btn-primary" onclick="showAuthModal()">Войти</button>
            <button class="btn btn-secondary" onclick="showRegModal()">Регистрация</button>
        </div>
        <div class="action-buttons" id="userButtons" style="display: none;">
            <button class="btn btn-success" id="createNewsBtn" onclick="showCreateNewsForm()" style="display: none;">Создать новость</button>
            <button class="btn btn-success" onclick="showCreateAdForm()">Создать объявление</button>
            <button class="btn btn-secondary" onclick="showMyContent()">Мои публикации</button>
            <button class="btn btn-danger" onclick="logout()">Выйти</button>
        </div>
    </div>
    
    <!-- Вкладки -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('news')" id="newsTab">Новости</div>
        <div class="tab" onclick="switchTab('ads')" id="adsTab">Объявления</div>
        <div class="tab" onclick="switchTab('admin')" id="adminTab" style="display: none;">Админ-панель</div>
    </div>
    
    <!-- Контейнер для контента -->
    <div id="contentContainer">
        <!-- Контент загружается здесь -->
    </div>
    
    <!-- Модальное окно авторизации -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 class="form-title">Вход в систему</h2>
            <form id="authForm" class="auth-form">
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" class="form-control" id="authEmail" required 
                           placeholder="example@mail.ru">
                </div>
                <div class="form-group">
                    <label>Пароль *</label>
                    <input type="password" class="form-control" id="authPassword" required 
                           placeholder="Введите пароль">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px;">
                        Войти
                    </button>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <span style="color: #65676b;">Нет аккаунта? </span>
                    <a href="javascript:void(0)" onclick="showRegModal()" style="color: #1877f2; font-weight: 600;">Зарегистрироваться</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно регистрации -->
    <div id="regModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 class="form-title">Регистрация</h2>
            <form id="regForm" class="auth-form">
                <div class="form-group">
                    <label>Имя *</label>
                    <input type="text" class="form-control" id="regName" required 
                           placeholder="Иван Иванов">
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" class="form-control" id="regEmail" required 
                           placeholder="example@mail.ru">
                </div>
                <div class="form-group">
                    <label>Пароль *</label>
                    <input type="password" class="form-control" id="regPassword" required 
                           placeholder="Придумайте пароль">
                </div>
                <div class="form-group">
                    <label>Телефон</label>
                    <input type="tel" class="form-control" id="regPhone" 
                           placeholder="+7 900 123-45-67">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success" style="width: 100%; padding: 15px;">
                        Зарегистрироваться
                    </button>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <span style="color: #65676b;">Уже есть аккаунт? </span>
                    <a href="javascript:void(0)" onclick="showAuthModal()" style="color: #1877f2; font-weight: 600;">Войти</a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно создания новости -->
    <div id="createNewsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>Создать новость</h2>
            <form id="createNewsForm">
                <div class="form-group">
                    <label>Заголовок новости *</label>
                    <input type="text" class="form-control" id="newsTitle" required 
                           placeholder="Важная новость района">
                </div>
                <div class="form-group">
                    <label>Содержание новости *</label>
                    <textarea class="form-control" id="newsContent" required rows="6"
                              placeholder="Подробно опишите новость..."></textarea>
                </div>
                <div class="form-group">
                    <label>Категория</label>
                    <select class="form-control" id="newsCategory">
                        <option value="general">Общие новости</option>
                        <option value="events">Мероприятия</option>
                        <option value="important">Важная информация</option>
                        <option value="culture">Культура</option>
                        <option value="sports">Спорт</option>
                        <option value="politics">Политика</option>
                        <option value="economy">Экономика</option>
                        <option value="education">Образование</option>
                        <option value="health">Здоровье</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success" style="width: 100%; padding: 15px;">
                        Опубликовать новость
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно создания объявления -->
    <div id="createAdModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>Создать объявление</h2>
            <form id="createAdForm">
                <div class="form-group">
                    <label>Название товара/услуги *</label>
                    <input type="text" class="form-control" id="adTitle" required 
                           placeholder="Например: Велосипед горный">
                </div>
                <div class="form-group">
                    <label>Описание *</label>
                    <textarea class="form-control" id="adDescription" required rows="4"
                              placeholder="Подробно опишите товар или услугу..."></textarea>
                </div>
                <div class="form-group">
                    <label>Цена (₽) *</label>
                    <input type="number" class="form-control" id="adPrice" required 
                           placeholder="5000">
                </div>
                <div class="form-group">
                    <label>Категория</label>
                    <select class="form-control" id="adCategory">
                        <option value="electronics">Электроника</option>
                        <option value="clothes">Одежда</option>
                        <option value="home">Для дома</option>
                        <option value="auto">Авто</option>
                        <option value="services">Услуги</option>
                        <option value="other" selected>Разное</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Город/район *</label>
                    <input type="text" class="form-control" id="adLocation" required 
                           placeholder="Томпо, Якутия">
                </div>
                <div class="form-group">
                    <label>Контактный телефон *</label>
                    <input type="tel" class="form-control" id="adPhone" required 
                           placeholder="+7 900 123-45-67">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success" style="width: 100%; padding: 15px;">
                        Опубликовать объявление
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно просмотра -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div id="detailContent">
                <!-- Детали загружаются сюда -->
            </div>
        </div>
    </div>

    <script>
        // ========================
        // БАЗА ДАННЫХ (в localStorage)
        // ========================
        
        // Инициализация данных
        let users = JSON.parse(localStorage.getItem('westnik_tompo_users')) || [
            {
                id: "admin_1",
                name: "Администратор",
                email: "admin@westnik.tompo",
                password: "admin123",
                phone: "+7 999 000-00-00",
                role: "admin",
                registered: "2024-01-01"
            },
            {
                id: "editor_1",
                name: "Редактор Новостей",
                email: "editor@westnik.tompo",
                password: "editor123",
                phone: "+7 999 111-11-11",
                role: "editor",
                registered: "2024-01-05"
            },
            {
                id: "user_1",
                name: "Иван Иванов",
                email: "ivan@mail.ru",
                password: "user123",
                phone: "+7 900 123-45-67",
                role: "user",
                registered: "2024-01-10"
            }
        ];
        
        let news = JSON.parse(localStorage.getItem('westnik_tompo_news')) || [
            {
                id: 1,
                title: "Открытие нового детского сада в Томпо",
                content: "Сегодня состоялось торжественное открытие нового детского сада 'Снежинка' в нашем районе. Сад рассчитан на 100 детей и оснащен современным оборудованием.",
                category: "important",
                authorId: "editor_1",
                authorName: "Редактор Новостей",
                date: new Date().toISOString().split('T')[0], // Сегодняшняя дата
                views: 156
            },
            {
                id: 2,
                title: "Зимний фестиваль народов Севера",
                content: "В ближайшие выходные в Томпо пройдет традиционный зимний фестиваль народов Севера. В программе: гонки на оленьих упряжках, выставка народных промыслов и дегустация национальных блюд.",
                category: "events",
                authorId: "editor_1",
                authorName: "Редактор Новостей",
                date: new Date(Date.now() - 86400000).toISOString().split('T')[0], // Вчера
                views: 89
            },
            {
                id: 3,
                title: "Новые спортивные площадки в районе",
                content: "В рамках программы развития спорта в районе установлены новые спортивные площадки с современным оборудованием.",
                category: "sports",
                authorId: "editor_1",
                authorName: "Редактор Новостей",
                date: new Date(Date.now() - 172800000).toISOString().split('T')[0], // 2 дня назад
                views: 45
            },
            {
                id: 4,
                title: "Обсуждение нового бюджета района",
                content: "На этой неделе состоится общественное обсуждение бюджета района на следующий год.",
                category: "politics",
                authorId: "editor_1",
                authorName: "Редактор Новостей",
                date: new Date(Date.now() - 259200000).toISOString().split('T')[0], // 3 дня назад
                views: 67
            }
        ];
        
        let ads = JSON.parse(localStorage.getItem('westnik_tompo_ads')) || [
            {
                id: 1,
                title: "Снегоход Yamaha 2018 года",
                description: "Снегоход в отличном состоянии, пробег 3000 км. Полностью исправен, готов к зиме. Торг уместен.",
                price: 250000,
                category: "auto",
                location: "Томпо, Якутия",
                phone: "+7 900 123-45-67",
                contactName: "Иван Иванов",
                userId: "user_1",
                date: new Date().toISOString().split('T')[0],
                views: 124
            },
            {
                id: 2,
                title: "Сдают квартиру 2-комнатную",
                description: "Сдается 2-комнатная квартира в центре Томпо. Ремонт свежий, мебель, бытовая техника. Долгосрочно.",
                price: 15000,
                category: "home",
                location: "Томпо, Якутия",
                phone: "+7 911 234-56-78",
                contactName: "Мария Петрова",
                userId: "user_2",
                date: new Date().toISOString().split('T')[0],
                views: 89
            }
        ];

        // Сохранить данные
        function saveData() {
            localStorage.setItem('westnik_tompo_users', JSON.stringify(users));
            localStorage.setItem('westnik_tompo_news', JSON.stringify(news));
            localStorage.setItem('westnik_tompo_ads', JSON.stringify(ads));
        }

        // Текущий пользователь
        let currentUser = JSON.parse(localStorage.getItem('current_user')) || null;
        let currentTab = 'news';
        
        // Переменные для фильтров новостей
        let selectedCategories = [];
        let timeFilter = 'all';
        let dateFrom = '';
        let dateTo = '';

        // ========================
        // СИСТЕМА АВТОРИЗАЦИИ
        // ========================
        
        function showAuthModal() {
            closeModal();
            document.getElementById('authModal').style.display = 'block';
        }
        
        function showRegModal() {
            closeModal();
            document.getElementById('regModal').style.display = 'block';
        }
        
        // Обработка формы авторизации
        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('current_user', JSON.stringify(user));
                updateUI();
                closeModal();
                showNotification('Успешный вход!');
                loadContent();
            } else {
                showNotification('Неверный email или пароль');
            }
        });
        
        // Обработка формы регистрации
        document.getElementById('regForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const phone = document.getElementById('regPhone').value;
            
            // Проверка, существует ли пользователь
            if (users.find(u => u.email === email)) {
                showNotification('Пользователь с таким email уже существует');
                return;
            }
            
            const newUser = {
                id: "user_" + Date.now(),
                name: name,
                email: email,
                password: password,
                phone: phone,
                role: "user",
                registered: new Date().toISOString().split('T')[0]
            };
            
            users.push(newUser);
            currentUser = newUser;
            localStorage.setItem('current_user', JSON.stringify(newUser));
            saveData();
            
            updateUI();
            closeModal();
            showNotification('Регистрация прошла успешно!');
            loadContent();
        });
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('current_user');
            updateUI();
            showNotification('Вы вышли из системы');
            loadContent();
        }
        
        // ========================
        // ОБНОВЛЕНИЕ ИНТЕРФЕЙСА
        // ========================
        
        function updateUI() {
            const authButtons = document.getElementById('authButtons');
            const userButtons = document.getElementById('userButtons');
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            const createNewsBtn = document.getElementById('createNewsBtn');
            const adminTab = document.getElementById('adminTab');
            
            if (currentUser) {
                authButtons.style.display = 'none';
                userButtons.style.display = 'flex';
                
                // Инициалы для аватара
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                userAvatar.textContent = initials;
                userName.textContent = currentUser.name;
                userRole.textContent = currentUser.role === 'admin' ? 'Администратор' : 
                                      currentUser.role === 'editor' ? 'Редактор' : 'Пользователь';
                
                // Показываем кнопку создания новости только для редакторов и админов
                createNewsBtn.style.display = (currentUser.role === 'editor' || currentUser.role === 'admin') ? 'flex' : 'none';
                
                // Показываем админ-панель только для админа
                adminTab.style.display = currentUser.role === 'admin' ? 'block' : 'none';
            } else {
                authButtons.style.display = 'flex';
                userButtons.style.display = 'none';
                userAvatar.textContent = 'Г';
                userName.textContent = 'Гость';
                userRole.textContent = 'Не авторизован';
                adminTab.style.display = 'none';
            }
        }
        
        // ========================
        // ПЕРЕКЛЮЧЕНИЕ ВКЛАДОК
        // ========================
        
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Обновляем активную вкладку
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (tabName === 'news') {
                document.getElementById('newsTab').classList.add('active');
            } else if (tabName === 'ads') {
                document.getElementById('adsTab').classList.add('active');
            } else if (tabName === 'admin') {
                document.getElementById('adminTab').classList.add('active');
            }
            
            loadContent();
        }
        
        // ========================
        // ЗАГРУЗКА КОНТЕНТА
        // ========================
        
        function loadContent() {
            if (currentTab === 'news') {
                renderNews();
            } else if (currentTab === 'ads') {
                renderAds();
            } else if (currentTab === 'admin') {
                renderAdminPanel();
            }
        }
        
        // ========================
        // ФУНКЦИИ ДЛЯ ФИЛЬТРАЦИИ НОВОСТЕЙ
        // ========================
        
        function refreshNews() {
            // В реальном приложении здесь был бы запрос к серверу
            // Для демо просто перезагружаем контент
            loadContent();
            showNotification('Новости обновлены');
        }
        
        function toggleCategory(category) {
            const index = selectedCategories.indexOf(category);
            if (index === -1) {
                selectedCategories.push(category);
            } else {
                selectedCategories.splice(index, 1);
            }
            applyNewsFilters();
        }
        
        function setTimeFilter(filter) {
            timeFilter = filter;
            applyNewsFilters();
        }
        
        function setDateFrom(date) {
            dateFrom = date;
            applyNewsFilters();
        }
        
        function setDateTo(date) {
            dateTo = date;
            applyNewsFilters();
        }
        
        function applyNewsFilters() {
            // Сначала обновляем UI кнопок
            updateFilterUI();
            
            // Затем перерисовываем новости
            renderNews();
        }
        
        function resetNewsFilters() {
            selectedCategories = [];
            timeFilter = 'all';
            dateFrom = '';
            dateTo = '';
            
            // Сбрасываем UI
            updateFilterUI();
            applyNewsFilters();
        }
        
        function updateFilterUI() {
            // Обновляем активные категории
            document.querySelectorAll('.category-tag').forEach(tag => {
                const category = tag.getAttribute('data-category');
                if (selectedCategories.includes(category)) {
                    tag.classList.add('active');
                } else {
                    tag.classList.remove('active');
                }
            });
            
            // Обновляем активные кнопки времени
            document.querySelectorAll('.time-btn').forEach(btn => {
                if (btn.getAttribute('data-filter') === timeFilter) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Обновляем даты в полях ввода
            if (document.getElementById('dateFrom')) {
                document.getElementById('dateFrom').value = dateFrom;
            }
            if (document.getElementById('dateTo')) {
                document.getElementById('dateTo').value = dateTo;
            }
            
            // Обновляем отображение активных фильтров
            updateActiveFiltersDisplay();
        }
        
        function updateActiveFiltersDisplay() {
            const container = document.getElementById('activeFilters');
            if (!container) return;
            
            let filtersHTML = '';
            
            // Фильтры по времени
            if (timeFilter !== 'all') {
                const timeLabels = {
                    'today': 'Сегодня',
                    'yesterday': 'Вчера',
                    'week': 'За неделю',
                    'month': 'За месяц'
                };
                filtersHTML += `<div class="filter-badge">${timeLabels[timeFilter]}</div>`;
            }
            
            // Фильтры по датам
            if (dateFrom) {
                filtersHTML += `<div class="filter-badge">С ${formatDisplayDate(dateFrom)}</div>`;
            }
            if (dateTo) {
                filtersHTML += `<div class="filter-badge">По ${formatDisplayDate(dateTo)}</div>`;
            }
            
            // Фильтры по категориям
            selectedCategories.forEach(category => {
                const categoryNames = {
                    'general': 'Общие',
                    'events': 'Мероприятия',
                    'important': 'Важные',
                    'culture': 'Культура',
                    'sports': 'Спорт',
                    'politics': 'Политика',
                    'economy': 'Экономика',
                    'education': 'Образование',
                    'health': 'Здоровье'
                };
                filtersHTML += `<div class="filter-badge">${categoryNames[category]}</div>`;
            });
            
            container.innerHTML = filtersHTML || '<div style="color: #8a8d91; font-size: 14px;">Нет активных фильтров</div>';
        }
        
        function getFilteredNews() {
            let filteredNews = [...news];
            
            // Фильтр по времени
            if (timeFilter !== 'all') {
                const now = new Date();
                filteredNews = filteredNews.filter(item => {
                    const itemDate = new Date(item.date);
                    const diffTime = now - itemDate;
                    const diffDays = diffTime / (1000 * 60 * 60 * 24);
                    
                    switch(timeFilter) {
                        case 'today':
                            return diffDays < 1;
                        case 'yesterday':
                            return diffDays >= 1 && diffDays < 2;
                        case 'week':
                            return diffDays < 7;
                        case 'month':
                            return diffDays < 30;
                        default:
                            return true;
                    }
                });
            }
            
            // Фильтр по датам
            if (dateFrom) {
                const fromDate = new Date(dateFrom);
                filteredNews = filteredNews.filter(item => new Date(item.date) >= fromDate);
            }
            
            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setHours(23, 59, 59, 999); // До конца дня
                filteredNews = filteredNews.filter(item => new Date(item.date) <= toDate);
            }
            
            // Фильтр по категориям
            if (selectedCategories.length > 0) {
                filteredNews = filteredNews.filter(item => selectedCategories.includes(item.category));
            }
            
            // Сортируем новости по дате (новые сначала)
            return filteredNews.sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        function renderNews() {
            const container = document.getElementById('contentContainer');
            
            const filteredNews = getFilteredNews();
            
            // Генерируем HTML для панели фильтров
            const filtersHTML = `
                <div class="filter-panel">
                    <div class="filter-section">
                        <h4>Фильтр по времени</h4>
                        <div class="time-filter">
                            <button class="time-btn ${timeFilter === 'all' ? 'active' : ''}" data-filter="all" onclick="setTimeFilter('all')">За всё время</button>
                            <button class="time-btn ${timeFilter === 'today' ? 'active' : ''}" data-filter="today" onclick="setTimeFilter('today')">Сегодня</button>
                            <button class="time-btn ${timeFilter === 'yesterday' ? 'active' : ''}" data-filter="yesterday" onclick="setTimeFilter('yesterday')">Вчера</button>
                            <button class="time-btn ${timeFilter === 'week' ? 'active' : ''}" data-filter="week" onclick="setTimeFilter('week')">За неделю</button>
                            <button class="time-btn ${timeFilter === 'month' ? 'active' : ''}" data-filter="month" onclick="setTimeFilter('month')">За месяц</button>
                        </div>
                        
                        <h4 style="margin-top: 15px;">Фильтр по датам</h4>
                        <div class="date-filter">
                            <div>
                                <label style="font-size: 12px; color: #65676b; display: block; margin-bottom: 5px;">С:</label>
                                <input type="date" class="date-input" id="dateFrom" onchange="setDateFrom(this.value)">
                            </div>
                            <div>
                                <label style="font-size: 12px; color: #65676b; display: block; margin-bottom: 5px;">По:</label>
                                <input type="date" class="date-input" id="dateTo" onchange="setDateTo(this.value)">
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 15px;">Категории</h4>
                        <div class="category-filters">
                            <div class="category-tag ${selectedCategories.includes('general') ? 'active' : ''}" data-category="general" onclick="toggleCategory('general')">
                                Общие
                            </div>
                            <div class="category-tag ${selectedCategories.includes('events') ? 'active' : ''}" data-category="events" onclick="toggleCategory('events')">
                                Мероприятия
                            </div>
                            <div class="category-tag ${selectedCategories.includes('important') ? 'active' : ''}" data-category="important" onclick="toggleCategory('important')">
                                Важные
                            </div>
                            <div class="category-tag ${selectedCategories.includes('culture') ? 'active' : ''}" data-category="culture" onclick="toggleCategory('culture')">
                                Культура
                            </div>
                            <div class="category-tag ${selectedCategories.includes('sports') ? 'active' : ''}" data-category="sports" onclick="toggleCategory('sports')">
                                Спорт
                            </div>
                            <div class="category-tag ${selectedCategories.includes('politics') ? 'active' : ''}" data-category="politics" onclick="toggleCategory('politics')">
                                Политика
                            </div>
                            <div class="category-tag ${selectedCategories.includes('economy') ? 'active' : ''}" data-category="economy" onclick="toggleCategory('economy')">
                                Экономика
                            </div>
                            <div class="category-tag ${selectedCategories.includes('education') ? 'active' : ''}" data-category="education" onclick="toggleCategory('education')">
                                Образование
                            </div>
                            <div class="category-tag ${selectedCategories.includes('health') ? 'active' : ''}" data-category="health" onclick="toggleCategory('health')">
                                Здоровье
                            </div>
                        </div>
                        
                        <div class="filter-actions">
                            <button class="btn btn-primary" onclick="applyNewsFilters()">Применить фильтры</button>
                            <button class="btn btn-secondary" onclick="resetNewsFilters()">Сбросить фильтры</button>
                            <button class="btn btn-success refresh-btn" onclick="refreshNews()">
                                Обновить новости
                            </button>
                        </div>
                        
                        <div id="activeFilters" class="active-filters"></div>
                    </div>
                </div>
            `;
            
            if (filteredNews.length === 0) {
                container.innerHTML = `
                    ${filtersHTML}
                    <div class="empty-state">
                        <div class="empty-icon">📰</div>
                        <h3>Новостей не найдено</h3>
                        <p>Попробуйте изменить параметры фильтров</p>
                        <button class="btn btn-secondary" onclick="resetNewsFilters()">Сбросить фильтры</button>
                    </div>
                `;
                updateFilterUI();
                return;
            }
            
            container.innerHTML = `
                ${filtersHTML}
                <div class="content-grid">
                    ${filteredNews.map(item => `
                        <div class="news-card" onclick="viewNews(${item.id})">
                            <div class="card-header">
                                <h3 class="news-title">${item.title}</h3>
                                <div class="news-date">
                                    <span>${formatDate(item.date)}</span>
                                    <span>${item.views || 0} просмотров</span>
                                    <span>${getCategoryName(item.category)}</span>
                                </div>
                            </div>
                            <div class="card-content">
                                <p class="news-excerpt">${item.content.substring(0, 150)}${item.content.length > 150 ? '...' : ''}</p>
                            </div>
                            <div class="card-footer">
                                <div class="author-info">
                                    <div class="author-avatar">${getInitials(item.authorName)}</div>
                                    <span>${item.authorName}</span>
                                </div>
                                <span style="font-size: 12px; color: #65676b;">
                                    ${timeAgo(new Date(item.date))}
                                </span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            updateFilterUI();
        }
        
        function renderAds() {
            const container = document.getElementById('contentContainer');
            
            // Все объявления видны всем (даже гостям)
            const allAds = ads;
            
            // Фильтры для объявлений
            const filtersHTML = `
                <div class="filters">
                    <input type="text" 
                           class="search-input" 
                           placeholder="Поиск по названию..." 
                           id="searchAdsInput"
                           oninput="filterAds()">
                    <select class="filter-select" id="categoryFilter" onchange="filterAds()">
                        <option value="">Все категории</option>
                        <option value="electronics">Электроника</option>
                        <option value="clothes">Одежда</option>
                        <option value="home">Для дома</option>
                        <option value="auto">Авто</option>
                        <option value="services">Услуги</option>
                        <option value="other">Разное</option>
                    </select>
                    <select class="filter-select" id="sortFilter" onchange="filterAds()">
                        <option value="newest">Сначала новые</option>
                        <option value="oldest">Сначала старые</option>
                        <option value="price_asc">Цена по возрастанию</option>
                        <option value="price_desc">Цена по убыванию</option>
                    </select>
                </div>
            `;
            
            if (allAds.length === 0) {
                container.innerHTML = `
                    ${filtersHTML}
                    <div class="empty-state">
                        <div class="empty-icon">📦</div>
                        <h3>Объявлений пока нет</h3>
                        <p>Создайте первое объявление для жителей Томпо!</p>
                        ${currentUser ? 
                            `<button class="btn btn-success" onclick="showCreateAdForm()">Создать объявление</button>` : 
                            `<button class="btn btn-primary" onclick="showAuthModal()">Войдите, чтобы создать объявление</button>`
                        }
                    </div>
                `;
                return;
            }
            
            // Показываем все объявления (они уже видны всем)
            const filteredAds = filterAdsList(allAds);
            
            container.innerHTML = `
                ${filtersHTML}
                <div class="content-grid">
                    ${filteredAds.map(item => `
                        <div class="ad-card" onclick="viewAd(${item.id})">
                            <div class="card-header">
                                <h3 class="ad-title">${item.title}</h3>
                                <div class="ad-date">${formatDate(item.date)} • ${item.views || 0} просмотров</div>
                            </div>
                            <div class="card-content">
                                <p class="ad-description">${item.description.substring(0, 100)}${item.description.length > 100 ? '...' : ''}</p>
                                <div class="ad-price">${formatPrice(item.price)}</div>
                                <div class="ad-location">${item.location}</div>
                            </div>
                            <div class="card-footer">
                                <div class="author-info">
                                    <span>${item.contactName || 'Продавец'}</span>
                                </div>
                                <span>${getCategoryName(item.category)}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function filterAdsList(adsList) {
            const searchTerm = document.getElementById('searchAdsInput')?.value.toLowerCase() || '';
            const category = document.getElementById('categoryFilter')?.value || '';
            const sortBy = document.getElementById('sortFilter')?.value || 'newest';
            
            let filtered = [...adsList];
            
            // Фильтр по поиску
            if (searchTerm) {
                filtered = filtered.filter(ad => 
                    ad.title.toLowerCase().includes(searchTerm) ||
                    ad.description.toLowerCase().includes(searchTerm) ||
                    (ad.contactName && ad.contactName.toLowerCase().includes(searchTerm))
                );
            }
            
            // Фильтр по категории
            if (category) {
                filtered = filtered.filter(ad => ad.category === category);
            }
            
            // Сортировка
            switch(sortBy) {
                case 'newest':
                    filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
                case 'oldest':
                    filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
                    break;
                case 'price_asc':
                    filtered.sort((a, b) => a.price - b.price);
                    break;
                case 'price_desc':
                    filtered.sort((a, b) => b.price - a.price);
                    break;
            }
            
            return filtered;
        }
        
        function filterAds() {
            if (currentTab === 'ads') {
                renderAds();
            }
        }
        
        function renderAdminPanel() {
            if (!currentUser || currentUser.role !== 'admin') {
                switchTab('news');
                return;
            }
            
            const container = document.getElementById('contentContainer');
            
            // Статистика
            const totalUsers = users.length;
            const regularUsers = users.filter(u => u.role === 'user').length;
            const editors = users.filter(u => u.role === 'editor').length;
            const admins = users.filter(u => u.role === 'admin').length;
            const totalNews = news.length;
            const totalAds = ads.length;
            
            container.innerHTML = `
                <div class="admin-panel">
                    <h3>Статистика системы</h3>
                    <div class="user-stats">
                        <div class="stat-card">
                            <div class="stat-number">${totalUsers}</div>
                            <div class="stat-label">Всего пользователей</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${regularUsers}</div>
                            <div class="stat-label">Обычные пользователи</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${editors}</div>
                            <div class="stat-label">Редакторы</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${admins}</div>
                            <div class="stat-label">Администраторы</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalNews}</div>
                            <div class="stat-label">Новостей</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${totalAds}</div>
                            <div class="stat-label">Объявлений</div>
                        </div>
                    </div>
                </div>
                
                <div class="admin-panel" style="margin-top: 20px;">
                    <h3>Все пользователи</h3>
                    <div class="user-list">
                        ${users.map(user => `
                            <div class="user-item">
                                <div>
                                    <strong>${user.name}</strong>
                                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                                        <span style="font-size: 12px; color: #65676b;">${user.email}</span>
                                        <span style="font-size: 12px; padding: 2px 6px; border-radius: 10px; 
                                              background: ${user.role === 'admin' ? '#dc3545' : user.role === 'editor' ? '#1877f2' : '#42b72a'}; 
                                              color: white;">
                                            ${user.role === 'admin' ? 'Админ' : user.role === 'editor' ? 'Редактор' : 'Пользователь'}
                                        </span>
                                    </div>
                                    <small style="color: #8a8d91;">Зарегистрирован: ${formatDate(user.registered)}</small>
                                </div>
                                <div>
                                    ${user.role === 'user' ? `
                                        <button class="btn btn-primary" onclick="makeEditor('${user.id}')">
                                            Назначить редактором
                                        </button>
                                    ` : user.role === 'editor' ? `
                                        <button class="btn btn-danger" onclick="removeEditor('${user.id}')">
                                            Убрать права редактора
                                        </button>
                                    ` : ''}
                                    ${user.role !== 'admin' ? `
                                        <button class="btn btn-secondary" onclick="deleteUser('${user.id}')" style="margin-left: 10px;">
                                            Удалить
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="admin-panel" style="margin-top: 20px;">
                    <h3>Управление контентом</h3>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button class="btn btn-secondary" onclick="showAllContent()">
                            Просмотреть все объявления
                        </button>
                        <button class="btn btn-secondary" onclick="showAllNews()">
                            Просмотреть все новости
                        </button>
                    </div>
                    <div style="color: #8a8d91; font-size: 14px;">
                        <p>Администратор может удалять любые новости и объявления через просмотр.</p>
                    </div>
                </div>
            `;
        }
        
        // ========================
        // СОЗДАНИЕ КОНТЕНТА
        // ========================
        
        function showCreateNewsForm() {
            if (!currentUser || (currentUser.role !== 'editor' && currentUser.role !== 'admin')) {
                showNotification('Только редакторы могут публиковать новости');
                return;
            }
            
            closeModal();
            document.getElementById('createNewsModal').style.display = 'block';
        }
        
        function showCreateAdForm() {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            closeModal();
            document.getElementById('createAdModal').style.display = 'block';
        }
        
        // Обработка формы создания новости
        document.getElementById('createNewsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const category = document.getElementById('newsCategory').value;
            
            const newNews = {
                id: Date.now(),
                title: title,
                content: content,
                category: category,
                authorId: currentUser.id,
                authorName: currentUser.name,
                date: new Date().toISOString().split('T')[0],
                views: 0
            };
            
            news.unshift(newNews);
            saveData();
            
            closeModal();
            showNotification('Новость успешно опубликована!');
            loadContent();
            
            // Сбрасываем форму
            document.getElementById('createNewsForm').reset();
        });
        
        // Обработка формы создания объявления
        document.getElementById('createAdForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('adTitle').value;
            const description = document.getElementById('adDescription').value;
            const price = parseInt(document.getElementById('adPrice').value);
            const category = document.getElementById('adCategory').value;
            const location = document.getElementById('adLocation').value;
            const phone = document.getElementById('adPhone').value || currentUser.phone;
            
            const newAd = {
                id: Date.now(),
                title: title,
                description: description,
                price: price,
                category: category,
                location: location,
                phone: phone,
                contactName: currentUser.name, // Сохраняем имя из профиля
                userId: currentUser.id,
                date: new Date().toISOString().split('T')[0],
                views: 0
            };
            
            ads.unshift(newAd);
            saveData();
            
            closeModal();
            showNotification('Объявление успешно опубликовано! Все пользователи видят его.');
            switchTab('ads');
            
            // Сбрасываем форму
            document.getElementById('createAdForm').reset();
        });
        
        // ========================
        // ПРОСМОТР КОНТЕНТА
        // ========================
        
        function viewNews(newsId) {
            const item = news.find(n => n.id === newsId);
            if (!item) return;
            
            // Увеличиваем счетчик просмотров
            item.views = (item.views || 0) + 1;
            saveData();
            
            document.getElementById('detailContent').innerHTML = `
                <div class="detail-container">
                    <div class="detail-header">
                        <h1 class="detail-title">${item.title}</h1>
                        <div class="detail-meta">
                            <span>${formatDate(item.date)}</span>
                            <span>${item.views} просмотров</span>
                            <span>${getCategoryName(item.category)}</span>
                            <span>Автор: ${item.authorName}</span>
                        </div>
                    </div>
                    
                    <div class="detail-content">
                        ${item.content}
                    </div>
                    
                    <div class="detail-footer">
                        <div>
                            ${item.authorId === currentUser?.id || currentUser?.role === 'admin' ? `
                                <button class="btn btn-danger" onclick="deleteNews(${item.id}); closeModal();">
                                    Удалить новость
                                </button>
                            ` : ''}
                        </div>
                        <button class="btn btn-secondary" onclick="closeModal()">
                            Закрыть
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('viewModal').style.display = 'block';
        }
        
        function viewAd(adId) {
            const item = ads.find(a => a.id === adId);
            if (!item) return;
            
            // Увеличиваем счетчик просмотров
            item.views = (item.views || 0) + 1;
            saveData();
            
            document.getElementById('detailContent').innerHTML = `
                <div class="detail-container">
                    <div class="detail-header">
                        <h1 class="detail-title">${item.title}</h1>
                        <div class="detail-meta">
                            <span>${formatDate(item.date)}</span>
                            <span>${item.views} просмотров</span>
                            <span>${getCategoryName(item.category)}</span>
                            <span>${item.location}</span>
                        </div>
                    </div>
                    
                    <div style="font-size: 32px; font-weight: bold; color: #1877f2; margin: 20px 0;">
                        ${formatPrice(item.price)}
                    </div>
                    
                    <div class="detail-content">
                        ${item.description}
                    </div>
                    
                    <div class="contact-info">
                        <h3 style="margin-bottom: 15px;">Контактная информация</h3>
                        
                        <div style="margin-bottom: 10px;">
                            <strong>Имя:</strong> ${item.contactName || 'Не указано'}
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #65676b; margin-bottom: 5px;">Телефон продавца:</div>
                            <div class="phone-number">${item.phone}</div>
                            
                            <div class="contact-buttons">
                                <a href="tel:${item.phone}" class="btn btn-call">
                                    Позвонить
                                </a>
                                <button class="btn btn-message" onclick="sendMessage('${item.userId}', '${item.contactName}')">
                                    Написать сообщение
                                </button>
                                <button class="btn btn-copy" onclick="copyPhone('${item.phone}')">
                                    Копировать номер
                                </button>
                            </div>
                            
                            <div style="margin-top: 15px; font-size: 12px; color: #65676b;">
                                Опубликовано: ${formatDate(item.date)}
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-footer">
                        <div>
                            ${item.userId === currentUser?.id || currentUser?.role === 'admin' ? `
                                <button class="btn btn-danger" onclick="deleteAd(${item.id}); closeModal();">
                                    Удалить объявление
                                </button>
                            ` : ''}
                        </div>
                        <button class="btn btn-secondary" onclick="closeModal()">
                            Закрыть
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('viewModal').style.display = 'block';
        }
        
        // ========================
        // АДМИНИСТРИРОВАНИЕ
        // ========================
        
        function makeEditor(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.role = 'editor';
                saveData();
                showNotification(`${user.name} теперь редактор`);
                renderAdminPanel();
            }
        }
        
        function removeEditor(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                user.role = 'user';
                saveData();
                showNotification(`${user.name} больше не редактор`);
                renderAdminPanel();
            }
        }
        
        function deleteUser(userId) {
            if (userId === currentUser.id) {
                showNotification('Вы не можете удалить свой аккаунт');
                return;
            }
            
            if (confirm('Удалить этого пользователя? Все его новости и объявления останутся.')) {
                users = users.filter(u => u.id !== userId);
                saveData();
                showNotification('Пользователь удален');
                renderAdminPanel();
            }
        }
        
        // ========================
        // УДАЛЕНИЕ КОНТЕНТА
        // ========================
        
        function deleteNews(newsId) {
            if (confirm('Удалить эту новость?')) {
                news = news.filter(n => n.id !== newsId);
                saveData();
                showNotification('Новость удалена');
                loadContent();
            }
        }
        
        function deleteAd(adId) {
            if (confirm('Удалить это объявление?')) {
                ads = ads.filter(a => a.id !== adId);
                saveData();
                showNotification('Объявление удалено');
                loadContent();
            }
        }
        
        // ========================
        // ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
        // ========================
        
        function closeModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('regModal').style.display = 'none';
            document.getElementById('createNewsModal').style.display = 'none';
            document.getElementById('createAdModal').style.display = 'none';
            document.getElementById('viewModal').style.display = 'none';
        }
        
        function showNotification(message) {
            // Удаляем старое уведомление
            const oldNotif = document.querySelector('.notification');
            if (oldNotif) oldNotif.remove();
            
            // Создаем новое
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = message;
            document.body.appendChild(notif);
            
            // Удаляем через 3 секунды
            setTimeout(() => notif.remove(), 3000);
        }
        
        function formatPrice(price) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0
            }).format(price);
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }
        
        function formatDisplayDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short'
            });
        }
        
        function getCategoryName(category) {
            const names = {
                general: 'Общие',
                events: 'Мероприятия',
                important: 'Важные',
                culture: 'Культура',
                sports: 'Спорт',
                politics: 'Политика',
                economy: 'Экономика',
                education: 'Образование',
                health: 'Здоровье',
                electronics: 'Электроника',
                clothes: 'Одежда',
                home: 'Для дома',
                auto: 'Авто',
                services: 'Услуги',
                other: 'Разное'
            };
            return names[category] || 'Разное';
        }
        
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }
        
        function timeAgo(date) {
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'только что';
            if (minutes < 60) return `${minutes} мин назад`;
            if (hours < 24) return `${hours} ч назад`;
            if (days < 7) return `${days} дн назад`;
            return formatDate(date.toISOString().split('T')[0]);
        }
        
        function showMyContent() {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            const myNews = news.filter(n => n.authorId === currentUser.id);
            const myAds = ads.filter(a => a.userId === currentUser.id);
            
            const container = document.getElementById('contentContainer');
            
            container.innerHTML = `
                <div class="detail-container">
                    <h2 style="margin-bottom: 20px;">Мои публикации</h2>
                    
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px; color: #1877f2;">Мои новости (${myNews.length})</h3>
                        ${myNews.length > 0 ? `
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${myNews.map(item => `
                                    <div style="padding: 15px; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${item.title}</strong><br>
                                            <small>${formatDate(item.date)} • ${item.views} просмотров</small>
                                        </div>
                                        <div>
                                            <button class="btn btn-secondary" onclick="viewNews(${item.id})" style="padding: 5px 10px; font-size: 12px;">Просмотреть</button>
                                            <button class="btn btn-danger" onclick="deleteNews(${item.id})" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p>У вас нет опубликованных новостей</p>'}
                    </div>
                    
                    <div>
                        <h3 style="margin-bottom: 15px; color: #42b72a;">Мои объявления (${myAds.length})</h3>
                        ${myAds.length > 0 ? `
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                ${myAds.map(item => `
                                    <div style="padding: 15px; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <strong>${item.title}</strong><br>
                                            <small>${formatDate(item.date)} • ${item.views} просмотров • ${formatPrice(item.price)}</small>
                                        </div>
                                        <div>
                                            <button class="btn btn-secondary" onclick="viewAd(${item.id})" style="padding: 5px 10px; font-size: 12px;">Просмотреть</button>
                                            <button class="btn btn-danger" onclick="deleteAd(${item.id})" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p>У вас нет опубликованных объявлений</p>'}
                    </div>
                </div>
            `;
        }
        
        function showAllContent() {
            const container = document.getElementById('contentContainer');
            
            container.innerHTML = `
                <div class="detail-container">
                    <h2 style="margin-bottom: 20px;">Все объявления (${ads.length})</h2>
                    
                    ${ads.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${ads.map(item => `
                                <div style="padding: 15px; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${item.title}</strong><br>
                                        <small>${formatDate(item.date)} • ${item.views} просмотров • ${formatPrice(item.price)} • Автор: ${item.contactName}</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-secondary" onclick="viewAd(${item.id})" style="padding: 5px 10px; font-size: 12px;">Просмотреть</button>
                                        <button class="btn btn-danger" onclick="deleteAd(${item.id})" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>Нет объявлений</p>'}
                </div>
            `;
        }
        
        function showAllNews() {
            const container = document.getElementById('contentContainer');
            
            container.innerHTML = `
                <div class="detail-container">
                    <h2 style="margin-bottom: 20px;">Все новости (${news.length})</h2>
                    
                    ${news.length > 0 ? `
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${news.map(item => `
                                <div style="padding: 15px; border: 1px solid #eee; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${item.title}</strong><br>
                                        <small>${formatDate(item.date)} • ${item.views} просмотров • Автор: ${item.authorName}</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-secondary" onclick="viewNews(${item.id})" style="padding: 5px 10px; font-size: 12px;">Просмотреть</button>
                                        <button class="btn btn-danger" onclick="deleteNews(${item.id})" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : '<p>Нет новостей</p>'}
                </div>
            `;
        }
        
        // Функции для связи с создателем объявления
        function copyPhone(phone) {
            navigator.clipboard.writeText(phone).then(() => {
                showNotification('Номер телефона скопирован');
            }).catch(() => {
                // Fallback для старых браузеров
                const tempInput = document.createElement('input');
                tempInput.value = phone;
                document.body.appendChild(tempInput);
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                showNotification('Номер телефона скопирован');
            });
        }
        
        function sendMessage(userId, userName) {
            const message = prompt(`Написать сообщение пользователю ${userName}:`, 'Здравствуйте! Меня интересует ваше объявление...');
            if (message) {
                // В реальном приложении здесь была бы отправка сообщения
                showNotification(`Сообщение для ${userName} отправлено (симуляция)`);
            }
        }
        
        // ========================
        // ИНИЦИАЛИЗАЦИЯ
        // ========================
        
        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        };

        // Загружаем данные при старте
        document.addEventListener('DOMContentLoaded', function() {
            updateUI();
            loadContent();
        });
    </script>
</body>
</html>
